<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - Sistema POS Ferreter√≠a</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîß</text></svg>">
    
    <style>
        .setup-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .setup-header {
            background: linear-gradient(135deg, var(--primary), #2d3748);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .setup-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid var(--primary);
        }
        
        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .setup-step {
            background: #f8fafc;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .step-number {
            display: inline-block;
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .progress-container {
            margin: 30px 0;
            background: #e2e8f0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .product-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .product-preview-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 10px;
            font-size: 0.9rem;
        }
        
        .log-container {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #2d3748;
        }
        
        .btn-setup {
            padding: 12px 24px;
            font-size: 1.1rem;
            margin: 10px 5px;
        }
        
        .danger-zone {
            border-left-color: var(--danger);
            background: linear-gradient(to right, #fff5f5, white);
        }
        
        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 15px;
        }
        
        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }
        
        .role-admin { background: #805ad5; color: white; }
        .role-supervisor { background: #3182ce; color: white; }
        .role-cajero { background: #38a169; color: white; }
        .role-vendedor { background: #d69e2e; color: white; }
    </style>
</head>
<body>
    <div class="setup-container">
        <!-- Header -->
        <div class="setup-header">
            <h1><i class="fas fa-tools"></i> Configuraci√≥n Inicial - Ferreter√≠a</h1>
            <p>Sistema POS Multipuesto - Configuraci√≥n de base de datos</p>
            <div style="margin-top: 20px; display: flex; justify-content: center; gap: 20px;">
                <div style="text-align: center;">
                    <div class="user-avatar-large">F</div>
                    <strong>Ferreter√≠a</strong>
                </div>
            </div>
        </div>
        
        <!-- Estado de Firebase -->
        <div class="setup-card">
            <h2><i class="fas fa-database"></i> Conexi√≥n a Firebase</h2>
            <div class="form-group">
                <label>Estado de conexi√≥n:</label>
                <div id="firebaseStatus" class="log-entry" style="color: #f56565;">
                    <i class="fas fa-circle-notch fa-spin"></i> Conectando...
                </div>
            </div>
            <div class="form-group">
                <label>Configuraci√≥n Firebase:</label>
                <textarea id="firebaseConfig" class="form-control" rows="4" readonly style="font-family: monospace; font-size: 0.9rem;">
apiKey: "AIzaSyCtOiUy2tUQeixUiJxTdI_ESULY4WpqXzw",
authDomain: "whatsappau-30dc1.firebaseapp.com",
projectId: "whatsappau-30dc1",
storageBucket: "whatsappau-30dc1.firebasestorage.app",
messagingSenderId: "456068013185",
appId: "1:456068013185:web:5bdd49337fb622e56f0180"</textarea>
            </div>
            <button id="btnTestConnection" class="btn btn-primary" onclick="testFirebaseConnection()">
                <i class="fas fa-plug"></i> Probar Conexi√≥n
            </button>
        </div>
        
        <!-- Progreso -->
        <div class="setup-card">
            <h2><i class="fas fa-tasks"></i> Progreso de Configuraci√≥n</h2>
            <div class="progress-container">
                <div id="setupProgress" class="progress-bar"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <span>0%</span>
                <span id="progressText">No iniciado</span>
                <span>100%</span>
            </div>
        </div>
        
        <!-- Log de actividades -->
        <div class="setup-card">
            <h2><i class="fas fa-clipboard-list"></i> Log de Actividades</h2>
            <div class="log-container" id="setupLog">
                <div class="log-entry">> Sistema de configuraci√≥n iniciado</div>
                <div class="log-entry">> Esperando conexi√≥n a Firebase...</div>
            </div>
            <button class="btn btn-outline" onclick="clearLog()">
                <i class="fas fa-broom"></i> Limpiar Log
            </button>
        </div>
        
        <!-- Pasos de configuraci√≥n -->
        <div class="setup-grid">
            <!-- Paso 1: Configuraci√≥n inicial -->
            <div class="setup-step">
                <h3><span class="step-number">1</span> Configuraci√≥n Inicial</h3>
                <p>Crea la estructura b√°sica de la base de datos y configuraci√≥n del sistema.</p>
                
                <div class="form-group">
                    <label>Nombre del Comercio:</label>
                    <input type="text" id="nombreComercio" class="form-control" value="Ferreter√≠a Central" placeholder="Ej: Ferreter√≠a Central">
                </div>
                
                <div class="form-group">
                    <label>Direcci√≥n:</label>
                    <input type="text" id="direccionComercio" class="form-control" value="Av. Principal 1234" placeholder="Direcci√≥n del comercio">
                </div>
                
                <div class="form-group">
                    <label>Tel√©fono:</label>
                    <input type="text" id="telefonoComercio" class="form-control" value="11-1234-5678" placeholder="Tel√©fono de contacto">
                </div>
                
                <button class="btn btn-primary btn-block btn-setup" onclick="crearConfiguracionInicial()">
                    <i class="fas fa-cogs"></i> Crear Configuraci√≥n
                </button>
            </div>
            
            <!-- Paso 2: Usuarios de prueba -->
            <div class="setup-step">
                <h3><span class="step-number">2</span> Usuarios de Prueba</h3>
                <p>Crea usuarios con diferentes roles para testing del sistema.</p>
                
                <div class="product-preview">
                    <div class="product-preview-item">
                        <strong>admin@ferreteria.com</strong><br>
                        <span class="role-badge role-admin">Administrador</span><br>
                        <small>Acceso completo al sistema</small>
                    </div>
                    <div class="product-preview-item">
                        <strong>supervisor@ferreteria.com</strong><br>
                        <span class="role-badge role-supervisor">Supervisor</span><br>
                        <small>Gesti√≥n de inventario y reportes</small>
                    </div>
                    <div class="product-preview-item">
                        <strong>cajero@ferreteria.com</strong><br>
                        <span class="role-badge role-cajero">Cajero</span><br>
                        <small>Ventas y caja</small>
                    </div>
                    <div class="product-preview-item">
                        <strong>vendedor@ferreteria.com</strong><br>
                        <span class="role-badge role-vendedor">Vendedor</span><br>
                        <small>Atenci√≥n al cliente y ventas</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Contrase√±a para todos los usuarios:</label>
                    <input type="password" id="userPassword" class="form-control" value="ferreteria123">
                </div>
                
                <button class="btn btn-primary btn-block btn-setup" onclick="crearUsuariosPrueba()">
                    <i class="fas fa-users"></i> Crear Usuarios
                </button>
            </div>
            
            <!-- Paso 3: Productos de ferreter√≠a -->
            <div class="setup-step">
                <h3><span class="step-number">3</span> Productos de Ferreter√≠a</h3>
                <p>Agrega productos de prueba categorizados para una ferreter√≠a.</p>
                
                <div class="form-group">
                    <label>Categor√≠as a crear:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        <span class="badge badge-primary">Herramientas Manuales</span>
                        <span class="badge badge-primary">Electricidad</span>
                        <span class="badge badge-primary">Fontaner√≠a</span>
                        <span class="badge badge-primary">Pinturas</span>
                        <span class="badge badge-primary">Fijaciones</span>
                        <span class="badge badge-primary">Jardiner√≠a</span>
                    </div>
                </div>
                
                <div class="product-preview" id="productPreview">
                    <!-- Los productos se cargar√°n din√°micamente -->
                </div>
                
                <button class="btn btn-primary btn-block btn-setup" onclick="crearProductosFerreteria()">
                    <i class="fas fa-hammer"></i> Crear Productos (50+)
                </button>
            </div>
            
            <!-- Paso 4: Clientes y proveedores -->
            <div class="setup-step">
                <h3><span class="step-number">4</span> Clientes y Proveedores</h3>
                <p>Crea clientes y proveedores de prueba para el sistema.</p>
                
                <div class="form-group">
                    <label>Clientes de prueba:</label>
                    <div style="margin-top: 10px;">
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <i class="fas fa-user" style="color: var(--primary); margin-right: 10px;"></i>
                            <span>Cliente Minorista (Consumidor final)</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <i class="fas fa-building" style="color: var(--secondary); margin-right: 10px;"></i>
                            <span>Constructora El Progreso S.A.</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <i class="fas fa-store" style="color: var(--success); margin-right: 10px;"></i>
                            <span>Distribuidora Mayorista</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Proveedores de prueba:</label>
                    <div style="margin-top: 10px;">
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <i class="fas fa-industry" style="color: var(--warning); margin-right: 10px;"></i>
                            <span>Industrias Met√°licas S.A.</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <i class="fas fa-truck" style="color: var(--danger); margin-right: 10px;"></i>
                            <span>Distribuidora de Herramientas</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-block btn-setup" onclick="crearClientesProveedores()">
                    <i class="fas fa-handshake"></i> Crear Clientes/Proveedores
                </button>
            </div>
            
            <!-- Paso 5: Setup completo -->
            <div class="setup-step">
                <h3><span class="step-number">5</span> Setup Completo</h3>
                <p>Ejecuta todos los pasos anteriores en orden para una configuraci√≥n completa.</p>
                
                <div style="background: #e6fffa; padding: 15px; border-radius: 5px; margin: 15px 0;">
                    <h4 style="color: var(--success); margin-top: 0;">
                        <i class="fas fa-check-circle"></i> Orden de ejecuci√≥n:
                    </h4>
                    <ol style="margin: 10px 0 0 20px;">
                        <li>Configuraci√≥n inicial</li>
                        <li>Usuarios de prueba</li>
                        <li>Productos de ferreter√≠a</li>
                        <li>Clientes y proveedores</li>
                    </ol>
                </div>
                
                <button class="btn btn-success btn-block btn-setup" onclick="setupCompleto()" style="padding: 15px; font-size: 1.2rem;">
                    <i class="fas fa-rocket"></i> EJECUTAR SETUP COMPLETO
                </button>
                
                <div style="margin-top: 20px; text-align: center;">
                    <a href="index.html" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i> Volver al Login
                    </a>
                </div>
            </div>
            
            <!-- Zona de peligro -->
            <div class="setup-step danger-zone">
                <h3><i class="fas fa-exclamation-triangle"></i> Zona de Peligro</h3>
                <p style="color: var(--danger);">Advertencia: Estas acciones eliminar√°n datos existentes.</p>
                
                <div class="form-group">
                    <label>Contrase√±a de confirmaci√≥n:</label>
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Ingrese 'CONFIRMAR' para proceder">
                </div>
                
                <button class="btn btn-danger btn-block btn-setup" onclick="eliminarTodosDatos()">
                    <i class="fas fa-trash"></i> Eliminar TODOS los datos
                </button>
                
                <button class="btn btn-warning btn-block btn-setup" onclick="resetearProductos()">
                    <i class="fas fa-redo"></i> Resetear solo productos
                </button>
            </div>
        </div>
        
        <!-- Notas finales -->
        <div class="setup-card" style="margin-top: 30px; background: #f0fff4; border-left-color: var(--success);">
            <h3><i class="fas fa-info-circle"></i> Notas importantes</h3>
            <ul>
                <li>Este setup es solo para desarrollo/pruebas iniciales.</li>
                <li>Los usuarios creados tienen la contrase√±a: <strong>ferreteria123</strong></li>
                <li>Los productos incluyen m√°rgenes de ganancia predefinidos.</li>
                <li>Se crean categor√≠as organizadas para ferreter√≠a.</li>
                <li>Despu√©s del setup, puedes acceder con: admin@ferreteria.com</li>
                <li>Recomendado: Ejecutar el "Setup Completo" una sola vez.</li>
            </ul>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN FIREBASE (MISMA QUE APP.JS)
        // ============================================
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCtOiUy2tUQeixUiJxTdI_ESULY4WpqXzw",
            authDomain: "whatsappau-30dc1.firebaseapp.com",
            projectId: "whatsappau-30dc1",
            storageBucket: "whatsappau-30dc1.firebasestorage.app",
            messagingSenderId: "456068013185",
            appId: "1:456068013185:web:5bdd49337fb622e56f0180"
        };

        const ROLES = {
            ADMIN: 'admin',
            SUPERVISOR: 'supervisor',
            CAJERO: 'cajero',
            VENDEDOR: 'vendedor'
        };

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        let app, auth, db;
        let totalSteps = 5;
        let completedSteps = 0;
        let setupLog = [];

        document.addEventListener('DOMContentLoaded', function() {
            logMessage('Sistema de setup iniciado');
            
            // Inicializar Firebase
            try {
                app = firebase.initializeApp(FIREBASE_CONFIG);
                auth = firebase.auth();
                db = firebase.firestore();
                
                logMessage('Firebase inicializado correctamente', 'success');
                updateFirebaseStatus('Conectado a Firebase', 'success');
                
                // Mostrar productos de ejemplo
                mostrarProductosEjemplo();
                
            } catch (error) {
                logMessage('Error inicializando Firebase: ' + error.message, 'error');
                updateFirebaseStatus('Error de conexi√≥n', 'error');
            }
        });

        // ============================================
        // FUNCIONES DE LOG Y UI
        // ============================================
        function logMessage(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            let icon = 'üìù';
            let color = '#68d391';
            
            switch(type) {
                case 'success':
                    icon = '‚úÖ';
                    color = '#68d391';
                    break;
                case 'error':
                    icon = '‚ùå';
                    color = '#fc8181';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    color = '#f6ad55';
                    break;
                case 'info':
                    icon = '‚ÑπÔ∏è';
                    color = '#63b3ed';
                    break;
            }
            
            const logEntry = {
                time: timestamp,
                message: message,
                type: type
            };
            
            setupLog.push(logEntry);
            
            const logContainer = document.getElementById('setupLog');
            if (logContainer) {
                const logElement = document.createElement('div');
                logElement.className = 'log-entry';
                logElement.innerHTML = `<span style="color: ${color}">${icon} [${timestamp}] ${message}</span>`;
                logContainer.appendChild(logElement);
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            console.log(`[${timestamp}] ${message}`);
        }

        function updateProgress(step, message) {
            completedSteps = step;
            const progress = (completedSteps / totalSteps) * 100;
            
            const progressBar = document.getElementById('setupProgress');
            const progressText = document.getElementById('progressText');
            
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
            
            if (progressText) {
                progressText.textContent = message || `${Math.round(progress)}% completado`;
            }
            
            logMessage(`Progreso: ${Math.round(progress)}% - ${message}`, 'info');
        }

        function updateFirebaseStatus(message, status) {
            const statusElement = document.getElementById('firebaseStatus');
            if (!statusElement) return;
            
            let icon = 'üîµ';
            let color = '#63b3ed';
            
            switch(status) {
                case 'success':
                    icon = 'üü¢';
                    color = '#68d391';
                    break;
                case 'error':
                    icon = 'üî¥';
                    color = '#fc8181';
                    break;
                case 'warning':
                    icon = 'üü°';
                    color = '#f6ad55';
                    break;
            }
            
            statusElement.innerHTML = `<span style="color: ${color}">${icon} ${message}</span>`;
        }

        function clearLog() {
            const logContainer = document.getElementById('setupLog');
            if (logContainer) {
                logContainer.innerHTML = '';
                logMessage('Log limpiado');
            }
        }

        function mostrarProductosEjemplo() {
            const productosEjemplo = [
                { codigo: "H001", nombre: "Martillo de Carpintero 500g", precio: 4500, categoria: "Herramientas Manuales" },
                { codigo: "H002", nombre: "Destornillador Phillips #2", precio: 1200, categoria: "Herramientas Manuales" },
                { codigo: "E001", nombre: "Cable El√©ctrico 2.5mm x 100m", precio: 28500, categoria: "Electricidad" },
                { codigo: "F001", nombre: "Llave Stillson 14\"", precio: 8900, categoria: "Fontaner√≠a" },
                { codigo: "P001", nombre: "Pintura Latex Blanco 20L", precio: 32500, categoria: "Pinturas" },
                { codigo: "FJ001", nombre: "Tornillo para Madera 3x50 (100u)", precio: 4500, categoria: "Fijaciones" },
                { codigo: "J001", nombre: "Manguera de Jard√≠n 1/2\" x 50m", precio: 18500, categoria: "Jardiner√≠a" }
            ];
            
            const preview = document.getElementById('productPreview');
            if (!preview) return;
            
            preview.innerHTML = '';
            productosEjemplo.forEach(producto => {
                const div = document.createElement('div');
                div.className = 'product-preview-item';
                div.innerHTML = `
                    <strong>${producto.codigo}</strong><br>
                    ${producto.nombre}<br>
                    <small>Categor√≠a: ${producto.categoria}</small><br>
                    <strong style="color: var(--primary);">$${producto.precio.toLocaleString()}</strong>
                `;
                preview.appendChild(div);
            });
        }

        // ============================================
        // FUNCIONES DE SETUP
        // ============================================
        async function testFirebaseConnection() {
            try {
                logMessage('Probando conexi√≥n a Firebase...');
                
                // Intentar una operaci√≥n simple
                const testRef = db.collection('test_connection').doc('test');
                await testRef.set({
                    test: true,
                    timestamp: new Date()
                });
                
                await testRef.delete();
                
                logMessage('Conexi√≥n a Firebase exitosa', 'success');
                updateFirebaseStatus('Conexi√≥n exitosa', 'success');
                
            } catch (error) {
                logMessage('Error de conexi√≥n a Firebase: ' + error.message, 'error');
                updateFirebaseStatus('Error de conexi√≥n', 'error');
            }
        }

        async function crearConfiguracionInicial() {
            try {
                logMessage('Creando configuraci√≥n inicial...');
                
                const nombre = document.getElementById('nombreComercio').value || 'Ferreter√≠a Central';
                const direccion = document.getElementById('direccionComercio').value || 'Av. Principal 1234';
                const telefono = document.getElementById('telefonoComercio').value || '11-1234-5678';
                
                const configData = {
                    empresa: {
                        nombre: nombre,
                        direccion: direccion,
                        telefono: telefono,
                        cuit: '30-12345678-9',
                        condicionIva: 'responsable_inscripto'
                    },
                    facturacion: {
                        puntoVenta: '0001',
                        ivaPorcentaje: 21,
                        autoImprimir: true,
                        generarTicket: true
                    },
                    sucursales: ['principal'],
                    cajas: ['caja1', 'caja2'],
                    impresion: {
                        tipo: 'ticket',
                        header: nombre,
                        footer: '¬°Gracias por su compra!',
                        mostrarIVA: true
                    },
                    inventario: {
                        alertaStockMinimo: true,
                        stockMinimo: 5,
                        controlStock: true
                    },
                    fechaCreacion: new Date(),
                    ultimaActualizacion: new Date()
                };
                
                await db.collection('configuracion').doc('principal').set(configData);
                
                // Crear contador de facturas
                await db.collection('contadores_facturas').doc('sucursal_principal').set({
                    sucursalId: 'principal',
                    proximo: 1,
                    ultimaActualizacion: new Date()
                });
                
                logMessage('Configuraci√≥n inicial creada exitosamente', 'success');
                updateProgress(1, 'Configuraci√≥n creada');
                
            } catch (error) {
                logMessage('Error creando configuraci√≥n: ' + error.message, 'error');
            }
        }

        async function crearUsuariosPrueba() {
            try {
                logMessage('Creando usuarios de prueba...');
                
                const password = document.getElementById('userPassword').value || 'ferreteria123';
                const usuarios = [
                    {
                        email: 'admin@ferreteria.com',
                        nombre: 'Administrador Sistema',
                        rol: ROLES.ADMIN,
                        sucursales: ['principal'],
                        telefono: '11-9876-5432'
                    },
                    {
                        email: 'supervisor@ferreteria.com',
                        nombre: 'Supervisor General',
                        rol: ROLES.SUPERVISOR,
                        sucursales: ['principal'],
                        telefono: '11-8765-4321'
                    },
                    {
                        email: 'cajero@ferreteria.com',
                        nombre: 'Cajero Principal',
                        rol: ROLES.CAJERO,
                        sucursales: ['principal'],
                        telefono: '11-7654-3210'
                    },
                    {
                        email: 'vendedor@ferreteria.com',
                        nombre: 'Vendedor 1',
                        rol: ROLES.VENDEDOR,
                        sucursales: ['principal'],
                        telefono: '11-6543-2109'
                    }
                ];
                
                for (const userData of usuarios) {
                    try {
                        // Crear usuario en Firebase Auth
                        const userCredential = await auth.createUserWithEmailAndPassword(userData.email, password);
                        const userId = userCredential.user.uid;
                        
                        // Guardar datos en Firestore
                        await db.collection('usuarios').doc(userId).set({
                            email: userData.email,
                            nombre: userData.nombre,
                            rol: userData.rol,
                            sucursales: userData.sucursales,
                            telefono: userData.telefono,
                            estado: 'activo',
                            fechaRegistro: new Date(),
                            ultimoAcceso: null
                        });
                        
                        logMessage(`Usuario creado: ${userData.email} (${userData.rol})`, 'success');
                        
                        // Cerrar sesi√≥n del usuario creado
                        await auth.signOut();
                        
                    } catch (error) {
                        if (error.code === 'auth/email-already-in-use') {
                            logMessage(`Usuario ${userData.email} ya existe`, 'warning');
                        } else {
                            logMessage(`Error creando usuario ${userData.email}: ${error.message}`, 'error');
                        }
                    }
                }
                
                updateProgress(2, 'Usuarios creados');
                logMessage('Proceso de creaci√≥n de usuarios completado', 'success');
                
            } catch (error) {
                logMessage('Error en creaci√≥n de usuarios: ' + error.message, 'error');
            }
        }

        async function crearProductosFerreteria() {
            try {
                logMessage('Creando productos de ferreter√≠a...');
                
                const categorias = [
                    'Herramientas Manuales',
                    'Herramientas El√©ctricas', 
                    'Electricidad',
                    'Fontaner√≠a',
                    'Pinturas',
                    'Fijaciones',
                    'Jardiner√≠a',
                    'Materiales de Construcci√≥n',
                    'Cerraduras y Seguridad',
                    'Iluminaci√≥n'
                ];
                
                // Crear categor√≠as primero
                for (const categoria of categorias) {
                    await db.collection('categorias').add({
                        nombre: categoria,
                        sucursalId: 'principal',
                        estado: 'activa',
                        fechaCreacion: new Date()
                    });
                }
                
                logMessage(`${categorias.length} categor√≠as creadas`, 'success');
                
                // Productos de ferreter√≠a (lista extensa)
                const productos = [
                    // Herramientas Manuales
                    { codigo: "HM001", nombre: "Martillo de Carpintero 500g", precioCosto: 2800, precioVenta: 4500, stock: 25, categoria: "Herramientas Manuales", proveedor: "Proveedor A", codigoBarras: "779123456001" },
                    { codigo: "HM002", nombre: "Martillo de Bola 750g", precioCosto: 3200, precioVenta: 5200, stock: 18, categoria: "Herramientas Manuales", proveedor: "Proveedor A", codigoBarras: "779123456002" },
                    { codigo: "HM003", nombre: "Destornillador Plano 6mm", precioCosto: 750, precioVenta: 1200, stock: 50, categoria: "Herramientas Manuales", proveedor: "Proveedor B", codigoBarras: "779123456003" },
                    { codigo: "HM004", nombre: "Destornillador Phillips #2", precioCosto: 800, precioVenta: 1300, stock: 45, categoria: "Herramientas Manuales", proveedor: "Proveedor B", codigoBarras: "779123456004" },
                    { codigo: "HM005", nombre: "Alicate Universal 8\"", precioCosto: 2200, precioVenta: 3800, stock: 30, categoria: "Herramientas Manuales", proveedor: "Proveedor A", codigoBarras: "779123456005" },
                    { codigo: "HM006", nombre: "Alicate de Corte 7\"", precioCosto: 2500, precioVenta: 4200, stock: 28, categoria: "Herramientas Manuales", proveedor: "Proveedor A", codigoBarras: "779123456006" },
                    { codigo: "HM007", nombre: "Llave Francesa 10\"", precioCosto: 3200, precioVenta: 5200, stock: 22, categoria: "Herramientas Manuales", proveedor: "Proveedor C", codigoBarras: "779123456007" },
                    { codigo: "HM008", nombre: "Juego de Llaves Allen", precioCosto: 1800, precioVenta: 3200, stock: 35, categoria: "Herramientas Manuales", proveedor: "Proveedor B", codigoBarras: "779123456008" },
                    
                    // Herramientas El√©ctricas
                    { codigo: "HE001", nombre: "Taladro Percutor 650W", precioCosto: 18500, precioVenta: 28500, stock: 8, categoria: "Herramientas El√©ctricas", proveedor: "Proveedor D", codigoBarras: "779123456101" },
                    { codigo: "HE002", nombre: "Amoladora Angular 4 1/2\"", precioCosto: 12500, precioVenta: 19800, stock: 10, categoria: "Herramientas El√©ctricas", proveedor: "Proveedor D", codigoBarras: "779123456102" },
                    { codigo: "HE003", nombre: "Sierra Caladora 500W", precioCosto: 9800, precioVenta: 16500, stock: 6, categoria: "Herramientas El√©ctricas", proveedor: "Proveedor D", codigoBarras: "779123456103" },
                    
                    // Electricidad
                    { codigo: "EL001", nombre: "Cable El√©ctrico 2.5mm x 100m", precioCosto: 18500, precioVenta: 28500, stock: 15, categoria: "Electricidad", proveedor: "Proveedor E", codigoBarras: "779123456201" },
                    { codigo: "EL002", nombre: "Cable El√©ctrico 1.5mm x 100m", precioCosto: 12500, precioVenta: 19800, stock: 20, categoria: "Electricidad", proveedor: "Proveedor E", codigoBarras: "779123456202" },
                    { codigo: "EL003", nombre: "Interruptor Simple Blanco", precioCosto: 450, precioVenta: 850, stock: 100, categoria: "Electricidad", proveedor: "Proveedor F", codigoBarras: "779123456203" },
                    { codigo: "EL004", nombre: "Tomacorriente Doble 10A", precioCosto: 520, precioVenta: 950, stock: 80, categoria: "Electricidad", proveedor: "Proveedor F", codigoBarras: "779123456204" },
                    { codigo: "EL005", nombre: "Caja Rectangular PVC", precioCosto: 120, precioVenta: 250, stock: 200, categoria: "Electricidad", proveedor: "Proveedor F", codigoBarras: "779123456205" },
                    
                    // Fontaner√≠a
                    { codigo: "FO001", nombre: "Llave Stillson 14\"", precioCosto: 5800, precioVenta: 8900, stock: 12, categoria: "Fontaner√≠a", proveedor: "Proveedor G", codigoBarras: "779123456301" },
                    { codigo: "FO002", nombre: "Ca√±o PVC 1/2\" x 6m", precioCosto: 850, precioVenta: 1500, stock: 50, categoria: "Fontaner√≠a", proveedor: "Proveedor G", codigoBarras: "779123456302" },
                    { codigo: "FO003", nombre: "Codo PVC 90¬∞ 1/2\"", precioCosto: 45, precioVenta: 120, stock: 300, categoria: "Fontaner√≠a", proveedor: "Proveedor G", codigoBarras: "779123456303" },
                    { codigo: "FO004", nombre: "Grifer√≠a Monocomando Cocina", precioCosto: 4200, precioVenta: 7200, stock: 8, categoria: "Fontaner√≠a", proveedor: "Proveedor H", codigoBarras: "779123456304" },
                    
                    // Pinturas
                    { codigo: "PI001", nombre: "Pintura Latex Blanco 20L", precioCosto: 19500, precioVenta: 32500, stock: 10, categoria: "Pinturas", proveedor: "Proveedor I", codigoBarras: "779123456401" },
                    { codigo: "PI002", nombre: "Pintura Latex Blanco 4L", precioCosto: 5200, precioVenta: 8500, stock: 25, categoria: "Pinturas", proveedor: "Proveedor I", codigoBarras: "779123456402" },
                    { codigo: "PI003", nombre: "Rodillo de Lana 9\"", precioCosto: 850, precioVenta: 1600, stock: 40, categoria: "Pinturas", proveedor: "Proveedor J", codigoBarras: "779123456403" },
                    { codigo: "PI004", nombre: "Brocha 2\" Cerdas Naturales", precioCosto: 650, precioVenta: 1200, stock: 60, categoria: "Pinturas", proveedor: "Proveedor J", codigoBarras: "779123456404" },
                    
                    // Fijaciones
                    { codigo: "FJ001", nombre: "Tornillo para Madera 3x50 (100u)", precioCosto: 2800, precioVenta: 4500, stock: 30, categoria: "Fijaciones", proveedor: "Proveedor K", codigoBarras: "779123456501" },
                    { codigo: "FJ002", nombre: "Tornillo Autorroscante 4x30 (100u)", precioCosto: 3200, precioVenta: 5200, stock: 28, categoria: "Fijaciones", proveedor: "Proveedor K", codigoBarras: "779123456502" },
                    { codigo: "FJ003", nombre: "Taco Pl√°stico 8x40 (50u)", precioCosto: 950, precioVenta: 1800, stock: 45, categoria: "Fijaciones", proveedor: "Proveedor K", codigoBarras: "779123456503" },
                    { codigo: "FJ004", nombre: "Clavo de Construcci√≥n 3\" (1kg)", precioCosto: 1200, precioVenta: 2200, stock: 40, categoria: "Fijaciones", proveedor: "Proveedor L", codigoBarras: "779123456504" },
                    
                    // Jardiner√≠a
                    { codigo: "JA001", nombre: "Manguera de Jard√≠n 1/2\" x 50m", precioCosto: 12500, precioVenta: 18500, stock: 15, categoria: "Jardiner√≠a", proveedor: "Proveedor M", codigoBarras: "779123456601" },
                    { codigo: "JA002", nombre: "Pistola para Manguera 6 Funciones", precioCosto: 2200, precioVenta: 3800, stock: 25, categoria: "Jardiner√≠a", proveedor: "Proveedor M", codigoBarras: "779123456602" },
                    { codigo: "JA003", nombre: "Tijera de Podar 8\"", precioCosto: 3200, precioVenta: 5200, stock: 18, categoria: "Jardiner√≠a", proveedor: "Proveedor N", codigoBarras: "779123456603" },
                    { codigo: "JA004", nombre: "Rastrillo de Jard√≠n 16 Dientes", precioCosto: 2800, precioVenta: 4500, stock: 20, categoria: "Jardiner√≠a", proveedor: "Proveedor N", codigoBarras: "779123456604" },
                    
                    // Materiales de Construcci√≥n
                    { codigo: "MC001", nombre: "Cemento Portland 50kg", precioCosto: 3200, precioVenta: 5200, stock: 50, categoria: "Materiales de Construcci√≥n", proveedor: "Proveedor O", codigoBarras: "779123456701" },
                    { codigo: "MC002", nombre: "Cal Hidratada 25kg", precioCosto: 1800, precioVenta: 3200, stock: 30, categoria: "Materiales de Construcci√≥n", proveedor: "Proveedor O", codigoBarras: "779123456702" },
                    { codigo: "MC003", nombre: "Arena por m3", precioCosto: 8500, precioVenta: 12500, stock: 10, categoria: "Materiales de Construcci√≥n", proveedor: "Proveedor O", codigoBarras: "779123456703" },
                    
                    // Cerraduras y Seguridad
                    { codigo: "CS001", nombre: "Cerradura Doble Paleta Bronce", precioCosto: 4200, precioVenta: 7200, stock: 15, categoria: "Cerraduras y Seguridad", proveedor: "Proveedor P", codigoBarras: "779123456801" },
                    { codigo: "CS002", nombre: "Candado de Seguridad 40mm", precioCosto: 2200, precioVenta: 3800, stock: 25, categoria: "Cerraduras y Seguridad", proveedor: "Proveedor P", codigoBarras: "779123456802" },
                    { codigo: "CS003", nombre: "Pomo Interior N√≠quel", precioCosto: 1800, precioVenta: 3200, stock: 20, categoria: "Cerraduras y Seguridad", proveedor: "Proveedor P", codigoBarras: "779123456803" },
                    
                    // Iluminaci√≥n
                    { codigo: "IL001", nombre: "LED Empotrable 12W Blanco", precioCosto: 650, precioVenta: 1200, stock: 60, categoria: "Iluminaci√≥n", proveedor: "Proveedor Q", codigoBarras: "779123456901" },
                    { codigo: "IL002", nombre: "Tubo LED 18W 120cm", precioCosto: 2200, precioVenta: 3800, stock: 35, categoria: "Iluminaci√≥n", proveedor: "Proveedor Q", codigoBarras: "779123456902" },
                    { codigo: "IL003", nombre: "Foco LED E27 9W", precioCosto: 450, precioVenta: 850, stock: 100, categoria: "Iluminaci√≥n", proveedor: "Proveedor Q", codigoBarras: "779123456903" }
                ];
                
                // Crear productos en lote
                const batch = db.batch();
                let contador = 0;
                
                for (const producto of productos) {
                    const productoRef = db.collection('productos').doc();
                    
                    const productoData = {
                        ...producto,
                        sucursalId: 'principal',
                        estado: 'activo',
                        controlStock: true,
                        stockMinimo: 5,
                        iva: 21,
                        fechaCreacion: new Date(),
                        fechaActualizacion: new Date(),
                        vendidosTotal: 0,
                        ubicacion: 'Estanter√≠a ' + Math.floor(Math.random() * 10) + 1
                    };
                    
                    batch.set(productoRef, productoData);
                    contador++;
                    
                    // Firestore tiene l√≠mite de 500 operaciones por batch
                    if (contador % 400 === 0) {
                        await batch.commit();
                        logMessage(`${contador} productos creados...`, 'info');
                    }
                }
                
                // Commit final si queda algo pendiente
                if (contador % 400 !== 0) {
                    await batch.commit();
                }
                
                logMessage(`${contador} productos de ferreter√≠a creados exitosamente`, 'success');
                updateProgress(3, `${contador} productos creados`);
                
            } catch (error) {
                logMessage('Error creando productos: ' + error.message, 'error');
            }
        }

        async function crearClientesProveedores() {
            try {
                logMessage('Creando clientes y proveedores...');
                
                // Clientes
                const clientes = [
                    {
                        nombre: "Consumidor Final",
                        tipo: "consumidor_final",
                        documento: "99999999",
                        email: "consumidor@final.com",
                        telefono: "11-0000-0000",
                        direccion: "Varios",
                        saldo: 0,
                        limiteCredito: 0
                    },
                    {
                        nombre: "Constructora El Progreso S.A.",
                        tipo: "empresa",
                        documento: "30-12345678-9",
                        email: "contacto@elprogreso.com",
                        telefono: "11-4321-5678",
                        direccion: "Av. Industrial 2345, Pilar",
                        saldo: 0,
                        limiteCredito: 500000,
                        contacto: "Juan P√©rez"
                    },
                    {
                        nombre: "Distribuidora Mayorista Central",
                        tipo: "empresa",
                        documento: "30-87654321-0",
                        email: "ventas@mayoristacentral.com",
                        telefono: "11-8765-4321",
                        direccion: "Zona Industrial Norte, Lote 45",
                        saldo: 0,
                        limiteCredito: 300000,
                        contacto: "Mar√≠a Gonz√°lez"
                    },
                    {
                        nombre: "Carlos Rodr√≠guez",
                        tipo: "particular",
                        documento: "20-12345678",
                        email: "carlos.rodriguez@gmail.com",
                        telefono: "11-1234-9876",
                        direccion: "Calle Falsa 123, CABA",
                        saldo: 0,
                        limiteCredito: 50000
                    },
                    {
                        nombre: "Mar√≠a Lopez",
                        tipo: "particular",
                        documento: "27-87654321",
                        email: "maria.lopez@hotmail.com",
                        telefono: "11-9876-1234",
                        direccion: "Av. Siempre Viva 742, Springfield",
                        saldo: 0,
                        limiteCredito: 30000
                    }
                ];
                
                for (const cliente of clientes) {
                    await db.collection('clientes').add({
                        ...cliente,
                        sucursalId: 'principal',
                        estado: 'activo',
                        fechaRegistro: new Date(),
                        comprasTotal: 0,
                        ultimaCompra: null
                    });
                }
                
                logMessage(`${clientes.length} clientes creados`, 'success');
                
                // Proveedores
                const proveedores = [
                    {
                        nombre: "Industrias Met√°licas S.A.",
                        documento: "30-11222333-4",
                        contacto: "Roberto Mart√≠nez",
                        email: "ventas@industriasmetalicas.com",
                        telefono: "11-2233-4455",
                        direccion: "Parque Industrial Pilar, Lote 12",
                        productos: ["Herramientas Manuales", "Herramientas El√©ctricas"],
                        estado: "activo"
                    },
                    {
                        nombre: "Distribuidora de Herramientas Norte",
                        documento: "30-44555666-7",
                        contacto: "Laura Fern√°ndez",
                        email: "laura@herramientasnorte.com",
                        telefono: "11-3344-5566",
                        direccion: "Ruta 9 Km 45, Escobar",
                        productos: ["Herramientas Manuales", "Fijaciones", "Electricidad"],
                        estado: "activo"
                    },
                    {
                        nombre: "Pinturer√≠as del Sur S.R.L.",
                        documento: "30-77888999-1",
                        contacto: "Diego S√°nchez",
                        email: "diego@pintureriassur.com",
                        telefono: "11-4455-6677",
                        direccion: "Av. San Mart√≠n 2345, Quilmes",
                        productos: ["Pinturas", "Rodillos", "Brochas"],
                        estado: "activo"
                    },
                    {
                        nombre: "Materiales de Construcci√≥n La Estrella",
                        documento: "30-99888777-6",
                        contacto: "Ana Torres",
                        email: "ana@materialesestrella.com",
                        telefono: "11-5566-7788",
                        direccion: "Ruta 2 Km 60, La Plata",
                        productos: ["Materiales de Construcci√≥n", "Fontaner√≠a"],
                        estado: "activo"
                    },
                    {
                        nombre: "Iluminaci√≥n LED Argentina",
                        documento: "30-66777888-9",
                        contacto: "Pablo G√≥mez",
                        email: "pablo@ledargentina.com",
                        telefono: "11-6677-8899",
                        direccion: "Av. Cabildo 3456, CABA",
                        productos: ["Iluminaci√≥n", "Electricidad"],
                        estado: "activo"
                    }
                ];
                
                for (const proveedor of proveedores) {
                    await db.collection('proveedores').add({
                        ...proveedor,
                        sucursalId: 'principal',
                        fechaRegistro: new Date()
                    });
                }
                
                logMessage(`${proveedores.length} proveedores creados`, 'success');
                updateProgress(4, 'Clientes y proveedores creados');
                
            } catch (error) {
                logMessage('Error creando clientes/proveedores: ' + error.message, 'error');
            }
        }

        async function setupCompleto() {
            try {
                logMessage('=== INICIANDO SETUP COMPLETO ===', 'info');
                
                // 1. Configuraci√≥n inicial
                await crearConfiguracionInicial();
                
                // 2. Usuarios de prueba
                await crearUsuariosPrueba();
                
                // 3. Productos de ferreter√≠a
                await crearProductosFerreteria();
                
                // 4. Clientes y proveedores
                await crearClientesProveedores();
                
                logMessage('=== SETUP COMPLETADO EXITOSAMENTE ===', 'success');
                updateProgress(5, 'Setup completo');
                
                // Mostrar mensaje final
                setTimeout(() => {
                    alert('‚úÖ Setup completado exitosamente!\n\nAhora puedes acceder al sistema con:\nEmail: admin@ferreteria.com\nContrase√±a: ferreteria123\n\nHaz clic en "Volver al Login" para comenzar.');
                }, 1000);
                
            } catch (error) {
                logMessage('Error en setup completo: ' + error.message, 'error');
            }
        }

        // ============================================
        // FUNCIONES DE LIMPIEZA (ZONA PELIGROSA)
        // ============================================
        async function eliminarTodosDatos() {
            const confirmacion = document.getElementById('confirmPassword').value;
            
            if (confirmacion !== 'CONFIRMAR') {
                alert('Debe escribir "CONFIRMAR" en el campo de contrase√±a para proceder');
                return;
            }
            
            if (!confirm('‚ö†Ô∏è ¬øEST√Å SEGURO?\n\nEsta acci√≥n eliminar√° TODOS los datos de la base de datos y no se puede deshacer.')) {
                return;
            }
            
            try {
                logMessage('Eliminando todos los datos...', 'warning');
                
                // Lista de colecciones a limpiar
                const colecciones = [
                    'usuarios',
                    'productos', 
                    'clientes',
                    'proveedores',
                    'categorias',
                    'ventas',
                    'turnos',
                    'configuracion',
                    'contadores_facturas',
                    'eventos_sistema'
                ];
                
                for (const coleccion of colecciones) {
                    try {
                        const snapshot = await db.collection(coleccion).get();
                        const batch = db.batch();
                        
                        snapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        
                        await batch.commit();
                        logMessage(`Colecci√≥n ${coleccion} eliminada`, 'success');
                        
                    } catch (error) {
                        logMessage(`Error eliminando ${coleccion}: ${error.message}`, 'error');
                    }
                }
                
                // Tambi√©n eliminar usuarios de Auth (esto es m√°s complejo y requiere admin SDK)
                logMessage('Nota: Los usuarios de Firebase Auth deben eliminarse manualmente desde la consola', 'warning');
                
                logMessage('Todos los datos han sido eliminados', 'success');
                updateProgress(0, 'Datos eliminados');
                
            } catch (error) {
                logMessage('Error eliminando datos: ' + error.message, 'error');
            }
        }

        async function resetearProductos() {
            const confirmacion = document.getElementById('confirmPassword').value;
            
            if (confirmacion !== 'CONFIRMAR') {
                alert('Debe escribir "CONFIRMAR" en el campo de contrase√±a para proceder');
                return;
            }
            
            if (!confirm('¬øResetear todos los productos? Esto eliminar√° todos los productos existentes.')) {
                return;
            }
            
            try {
                logMessage('Reseteando productos...', 'warning');
                
                // Eliminar productos existentes
                const snapshot = await db.collection('productos').get();
                const batch = db.batch();
                
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                logMessage('Productos existentes eliminados', 'success');
                
                // Crear productos de prueba nuevamente
                await crearProductosFerreteria();
                
                logMessage('Productos reseteados exitosamente', 'success');
                
            } catch (error) {
                logMessage('Error reseteando productos: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
