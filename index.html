<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema POS Comercial 4.0</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
</head>
<body data-theme="light">
    <!-- Teclado num√©rico virtual -->
    <div id="tecladoNumerico">
        <div class="teclado-grid">
            <button class="btn-num" data-num="1">1</button>
            <button class="btn-num" data-num="2">2</button>
            <button class="btn-num" data-num="3">3</button>
            <button class="btn-num" data-num="4">4</button>
            <button class="btn-num" data-num="5">5</button>
            <button class="btn-num" data-num="6">6</button>
            <button class="btn-num" data-num="7">7</button>
            <button class="btn-num" data-num="8">8</button>
            <button class="btn-num" data-num="9">9</button>
            <button class="btn-num" data-num=".">.</button>
            <button class="btn-num" data-num="0">0</button>
            <button class="btn-num" id="btnEnter">Enter</button>
        </div>
        <div class="teclado-close">
            <button onclick="toggleTecladoNumerico()" class="btn btn-danger btn-sm">‚úï Cerrar Teclado</button>
        </div>
    </div>

    <!-- Modal gen√©rico -->
    <div id="genericModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">T√≠tulo</h2>
                <span class="modal-close" onclick="handleModalCancel()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                Contenido del modal
            </div>
            <div class="modal-footer">
                <button id="modalConfirm" class="btn btn-primary">Confirmar</button>
                <button id="modalCancel" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de pago -->
    <div id="paymentModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Confirmar Pago</h2>
                <span class="modal-close" onclick="document.getElementById('paymentModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <div class="payment-summary">
                    <h3>Total a pagar: <span id="paymentTotalAmount">$0.00</span></h3>
                </div>
                
                <div class="payment-methods">
                    <button class="payment-btn" data-method="efectivo">
                        <i class="fas fa-money-bill-wave"></i> Efectivo
                    </button>
                    <button class="payment-btn" data-method="tarjeta">
                        <i class="fas fa-credit-card"></i> Tarjeta
                    </button>
                    <button class="payment-btn" data-method="transferencia">
                        <i class="fas fa-university"></i> Transferencia
                    </button>
                    <button class="payment-btn" data-method="qr">
                        <i class="fas fa-qrcode"></i> QR
                    </button>
                    <button class="payment-btn" data-method="cuenta">
                        <i class="fas fa-file-invoice-dollar"></i> Cuenta Corriente
                    </button>
                    <button class="payment-btn" data-method="combinado">
                        <i class="fas fa-random"></i> Combinado
                    </button>
                </div>
                
                <div id="paymentDetails" class="payment-details">
                    <!-- Detalles del m√©todo de pago se cargan aqu√≠ -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmPayment" class="btn btn-success btn-lg">Confirmar Pago</button>
                <button id="cancelPayment" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Contenedor de scanner -->
    <div id="scannerContainer" class="scanner-container">
        <div class="scanner-header">
            <h3><i class="fas fa-barcode"></i> Escanear C√≥digo de Barras</h3>
            <button id="stopScanner" class="btn btn-danger">‚úï Detener</button>
        </div>
        <video id="scannerVideo" autoplay playsinline></video>
        <div class="scanner-overlay">
            <div class="scanner-frame"></div>
            <p>Apunta el c√≥digo de barras al centro del marco</p>
        </div>
    </div>

    <!-- Pantalla de login -->
    <div id="loginScreen" class="screen login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-cash-register"></i> POS 4.0</h1>
                <p>Sistema Comercial de Punto de Venta</p>
            </div>
            
            <div class="login-form">
                <h2>Iniciar Sesi√≥n</h2>
                <div class="form-group">
                    <label for="loginEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="usuario@ejemplo.com" autofocus>
                </div>
                <div class="form-group">
                    <label for="loginPassword"><i class="fas fa-lock"></i> Contrase√±a</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Ingresa tu contrase√±a">
                </div>
                <div id="loginStatus"></div>
                <button id="loginBtn" class="btn btn-primary btn-block btn-lg">
                    <i class="fas fa-sign-in-alt"></i> Ingresar al Sistema
                </button>
            </div>
            
            <div class="login-footer">
                <p>Versi√≥n 4.0.0 ‚Ä¢ Sistema POS Comercial</p>
                <p><i class="fas fa-circle"></i> <span id="syncStatus">üü¢ Conectado</span></p>
            </div>
        </div>
    </div>

    <!-- Pantalla principal de la aplicaci√≥n -->
    <div id="appScreen" class="screen app-screen" style="display: none;">
        <!-- Configuraci√≥n inicial -->
        <div id="initialConfig" class="initial-config">
            <div class="config-container">
                <div class="config-header">
                    <h1><i class="fas fa-cogs"></i> Configurar Sesi√≥n de Trabajo</h1>
                    <p>Completa los datos para comenzar</p>
                </div>
                
                <div class="config-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="selectLocal"><i class="fas fa-store"></i> Local *</label>
                            <select id="selectLocal" class="form-control" required>
                                <option value="">Seleccionar local...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="selectCaja"><i class="fas fa-cash-register"></i> Caja *</label>
                            <select id="selectCaja" class="form-control" required>
                                <option value="">Seleccionar caja...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="selectTurno"><i class="fas fa-clock"></i> Turno *</label>
                            <select id="selectTurno" class="form-control" required>
                                <option value="ma√±ana">Ma√±ana</option>
                                <option value="tarde">Tarde</option>
                                <option value="noche">Noche</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="saldoInicial"><i class="fas fa-dollar-sign"></i> Saldo Inicial en Caja</label>
                            <input type="number" id="saldoInicial" class="form-control" value="0" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <button id="startSession" class="btn btn-success btn-block btn-lg">
                        <i class="fas fa-play"></i> Iniciar Sesi√≥n de Trabajo
                    </button>
                </div>
            </div>
        </div>

        <!-- Aplicaci√≥n principal -->
        <div id="mainApp" class="main-app" style="display: none;">
            <!-- Barra superior -->
            <header class="app-header">
                <div class="header-left">
                    <div class="logo">
                        <i class="fas fa-cash-register"></i>
                        <span>POS <strong>4.0</strong></span>
                    </div>
                    <div class="session-info">
                        <span id="userInfo" class="info-item"><i class="fas fa-user"></i> Usuario</span>
                        <span id="localInfo" class="info-item"><i class="fas fa-store"></i> Local</span>
                        <span id="cajaInfo" class="info-item"><i class="fas fa-cash-register"></i> Caja</span>
                        <span id="turnoInfo" class="info-item"><i class="fas fa-clock"></i> Turno</span>
                    </div>
                </div>
                
                <div class="header-center">
                    <h2 id="currentPage">Punto de Venta</h2>
                </div>
                
                <div class="header-right">
                    <button id="syncManual" class="btn btn-outline btn-sm">
                        <i class="fas fa-sync-alt"></i> Sincronizar
                    </button>
                    <button id="cerrarCaja" class="btn btn-warning btn-sm">
                        <i class="fas fa-door-closed"></i> Cerrar Caja
                    </button>
                    <button id="logoutBtn" class="btn btn-danger btn-sm">
                        <i class="fas fa-sign-out-alt"></i> Salir
                    </button>
                    <button id="themeToggle" class="btn btn-outline btn-sm">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </header>

            <!-- Navegaci√≥n principal -->
            <nav class="main-nav">
                <button class="nav-btn active" data-page="pos">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Ventas</span>
                </button>
                <button class="nav-btn" data-page="productos">
                    <i class="fas fa-boxes"></i>
                    <span>Productos</span>
                </button>
                <button class="nav-btn" data-page="clientes">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </button>
                <button class="nav-btn" data-page="proveedores">
                    <i class="fas fa-truck"></i>
                    <span>Proveedores</span>
                </button>
                <button class="nav-btn" data-page="presupuestos">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Presupuestos</span>
                </button>
                <button class="nav-btn" data-page="ventas">
                    <i class="fas fa-receipt"></i>
                    <span>Ventas</span>
                </button>
                <button class="nav-btn" data-page="caja">
                    <i class="fas fa-calculator"></i>
                    <span>Caja</span>
                </button>
                <button class="nav-btn" data-page="reportes">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </button>
            </nav>

            <!-- Contenedor de alertas -->
            <div id="alertasContainer" class="alertas-container"></div>

            <!-- Contenido principal -->
            <main class="main-content">
                <!-- P√°gina: Punto de Venta -->
                <div id="pagePos" class="page active">
                    <div class="pos-container">
                        <!-- Panel izquierdo: B√∫squeda y productos -->
                        <div class="pos-left">
                            <div class="search-container">
                                <div class="search-header">
                                    <h3><i class="fas fa-search"></i> B√∫squeda de Productos</h3>
                                    <div class="search-actions">
                                        <button id="activarTecladoNumerico" class="btn btn-outline btn-sm" title="Teclado num√©rico">
                                            <i class="fas fa-keyboard"></i>
                                        </button>
                                        <button id="keyboardMode" class="btn btn-outline btn-sm" title="Modo teclado">
                                            <i class="fas fa-keyboard"></i>
                                        </button>
                                        <button id="scanBarcode" class="btn btn-outline btn-sm" title="Escanear c√≥digo">
                                            <i class="fas fa-barcode"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="search-box">
                                    <input type="text" id="productSearch" class="form-control" 
                                           placeholder="C√≥digo, nombre, marca o proveedor..." 
                                           autocomplete="off" autofocus>
                                    <button id="buscarProductoBtn" class="btn btn-primary">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                
                                <div class="cliente-selector">
                                    <label for="selectCliente"><i class="fas fa-user"></i> Cliente:</label>
                                    <select id="selectCliente" class="form-control">
                                        <option value="">Cliente Contado</option>
                                        <option value="nuevo">‚ûï Nuevo Cliente</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="products-grid-header">
                                <h4>Productos Disponibles</h4>
                                <div class="grid-actions">
                                    <span class="stock-legend">
                                        <span class="legend-item"><span class="legend-color normal"></span> Stock Normal</span>
                                        <span class="legend-item"><span class="legend-color bajo"></span> Stock Bajo</span>
                                        <span class="legend-item"><span class="legend-color critico"></span> Stock Cr√≠tico</span>
                                    </span>
                                </div>
                            </div>
                            
                            <div id="productsGrid" class="products-grid">
                                <!-- Productos cargados din√°micamente -->
                                <div class="no-data">Busca productos para comenzar</div>
                            </div>
                        </div>
                        
                        <!-- Panel derecho: Carrito de compras -->
                        <div class="pos-right">
                            <div class="cart-header">
                                <h3><i class="fas fa-shopping-cart"></i> Carrito de Venta</h3>
                                <div class="cart-actions">
                                    <button id="aplicarPromocion" class="btn btn-outline btn-sm" title="Aplicar promoci√≥n">
                                        <i class="fas fa-tag"></i>
                                    </button>
                                    <button id="crearPresupuesto" class="btn btn-info btn-sm">
                                        <i class="fas fa-file-invoice-dollar"></i> Presupuesto
                                    </button>
                                    <button id="cancelarVenta" class="btn btn-danger btn-sm">
                                        <i class="fas fa-times"></i> Cancelar
                                    </button>
                                </div>
                            </div>
                            
                            <div class="cart-items-container">
                                <div class="cart-items-header">
                                    <span>Producto</span>
                                    <span>Cantidad</span>
                                    <span>Unidad</span>
                                    <span>Precio</span>
                                    <span>Subtotal</span>
                                    <span>Acciones</span>
                                </div>
                                <div id="cartItems" class="cart-items">
                                    <!-- Items del carrito cargados din√°micamente -->
                                    <div class="cart-empty">üéØ Busca y agrega productos al carrito</div>
                                </div>
                            </div>
                            
                            <div class="cart-summary">
                                <div class="summary-row">
                                    <span>Subtotal:</span>
                                    <span id="cartSubtotal">$0.00</span>
                                </div>
                                <div class="summary-row">
                                    <label for="cartDiscount">Descuento:</label>
                                    <input type="number" id="cartDiscount" class="form-control-sm" value="0" min="0" step="0.01">
                                </div>
                                <div class="summary-row total">
                                    <span><strong>TOTAL:</strong></span>
                                    <span id="cartTotal" class="total-amount">$0.00</span>
                                </div>
                            </div>
                            
                            <div class="cart-actions-bottom">
                                <button id="finalizarVenta" class="btn btn-success btn-lg btn-block">
                                    <i class="fas fa-check-circle"></i> FINALIZAR VENTA
                                </button>
                                <div class="hint">
                                    <small><i class="fas fa-info-circle"></i> F2: Editar cantidad ‚Ä¢ Enter: Confirmar ‚Ä¢ Flechas: Navegar</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- P√°gina: Productos -->
                <div id="pageProductos" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-boxes"></i> Gesti√≥n de Productos</h2>
                        <div class="page-actions">
                            <div class="search-box">
                                <input type="text" id="filterProductos" class="form-control" placeholder="Filtrar productos...">
                            </div>
                            <button id="nuevoProducto" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </button>
                            <button id="importarExcel" class="btn btn-outline" title="Importar desde Excel">
                                <i class="fas fa-file-import"></i>
                            </button>
                            <button id="exportarExcel" class="btn btn-outline" title="Exportar a Excel">
                                <i class="fas fa-file-export"></i>
                            </button>
                            <button id="filterStockBajo" class="btn btn-warning">
                                <i class="fas fa-exclamation-triangle"></i> Stock Bajo
                            </button>
                            <button id="generarPedidos" class="btn btn-info" title="Generar pedidos autom√°ticos">
                                <i class="fas fa-truck-loading"></i> Pedidos
                            </button>
                        </div>
                    </div>
                    
                    <div id="productosList" class="products-list">
                        <!-- Productos cargados din√°micamente -->
                        <div class="loading">Cargando productos...</div>
                    </div>
                </div>

                <!-- P√°gina: Clientes -->
                <div id="pageClientes" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-users"></i> Gesti√≥n de Clientes</h2>
                        <div class="page-actions">
                            <button id="nuevoCliente" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Cliente
                            </button>
                            <button id="nuevoClientePage" class="btn btn-primary" style="display: none;">
                                <i class="fas fa-plus"></i> Nuevo Cliente
                            </button>
                            <button id="verCajasBtn" class="btn btn-outline">
                                <i class="fas fa-history"></i> Ver Cierres
                            </button>
                        </div>
                    </div>
                    
                    <div id="clientesList" class="table-container">
                        <!-- Clientes cargados din√°micamente -->
                        <div class="loading">Cargando clientes...</div>
                    </div>
                </div>

                <!-- P√°gina: Proveedores -->
                <div id="pageProveedores" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-truck"></i> Gesti√≥n de Proveedores</h2>
                        <div class="page-actions">
                            <button id="nuevoProveedor" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Proveedor
                            </button>
                            <button id="webProveedorBtn" class="btn btn-outline">
                                <i class="fas fa-globe"></i> Web Proveedor
                            </button>
                        </div>
                    </div>
                    
                    <div id="proveedoresList" class="table-container">
                        <!-- Proveedores cargados din√°micamente -->
                        <div class="loading">Cargando proveedores...</div>
                    </div>
                </div>

                <!-- P√°gina: Presupuestos -->
                <div id="pagePresupuestos" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-file-invoice-dollar"></i> Gesti√≥n de Presupuestos</h2>
                    </div>
                    
                    <div id="presupuestosList" class="table-container">
                        <!-- Presupuestos cargados din√°micamente -->
                        <div class="loading">Cargando presupuestos...</div>
                    </div>
                </div>

                <!-- P√°gina: Ventas -->
                <div id="pageVentas" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-receipt"></i> Historial de Ventas</h2>
                    </div>
                    
                    <div id="ventasList" class="table-container">
                        <!-- Ventas cargadas din√°micamente -->
                        <div class="loading">Cargando ventas...</div>
                    </div>
                </div>

                <!-- P√°gina: Caja -->
                <div id="pageCaja" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-calculator"></i> Caja y Arqueo</h2>
                        <div class="page-actions">
                            <button id="retirarEfectivo" class="btn btn-warning">
                                <i class="fas fa-money-bill-wave"></i> Retirar Efectivo
                            </button>
                        </div>
                    </div>
                    
                    <div class="caja-container">
                        <div class="caja-resumen">
                            <h3><i class="fas fa-cash-register"></i> Resumen de Caja</h3>
                            <div class="resumen-grid">
                                <div class="resumen-item">
                                    <span>Saldo Inicial:</span>
                                    <span id="saldoInicialResumen" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Ventas Efectivo:</span>
                                    <span id="ventasEfectivo" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Ventas Tarjeta:</span>
                                    <span id="ventasTarjeta" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Ventas Transferencia:</span>
                                    <span id="ventasTransferencia" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Ventas QR:</span>
                                    <span id="ventasQr" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Ventas Cuenta Corriente:</span>
                                    <span id="ventasCuenta" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Retiros de Efectivo:</span>
                                    <span id="retirosEfectivo" class="amount negativo">$0.00</span>
                                </div>
                                <div class="resumen-item total">
                                    <span>Total Ventas:</span>
                                    <span id="totalVentas" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Saldo Final:</span>
                                    <span id="saldoFinal" class="amount">$0.00</span>
                                </div>
                                <div class="resumen-item">
                                    <span>Diferencia:</span>
                                    <span id="diferenciaResumen" class="amount">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- P√°gina: Reportes -->
                <div id="pageReportes" class="page">
                    <div class="page-header">
                        <h2><i class="fas fa-chart-bar"></i> Reportes y Estad√≠sticas</h2>
                    </div>
                    
                    <div id="reportesContent" class="reportes-container">
                        <!-- Reportes cargados din√°micamente -->
                        <div class="loading">Cargando reportes...</div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
