<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema POS - Facturaci√≥n Comercial</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK v√≠a CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- HTML2PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè™</text></svg>">
</head>
<body>
    <!-- Pantalla de Login (visible solo sin sesi√≥n) -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-cash-register"></i> Sistema POS Comercial</h1>
                <p>Sistema de Facturaci√≥n y Gesti√≥n Multipuesto</p>
            </div>
            
            <div class="login-card">
                <h2>Iniciar Sesi√≥n</h2>
                <div class="form-group">
                    <label for="loginEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="usuario@comercio.com">
                </div>
                <div class="form-group">
                    <label for="loginPassword"><i class="fas fa-lock"></i> Contrase√±a</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="rememberMe"> Recordar sesi√≥n
                    </label>
                </div>
                
                <button id="btnLogin" class="btn btn-primary btn-block" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Ingresar al Sistema
                </button>
                
                <div class="login-footer">
                    <p>Versi√≥n 2.0 ‚Ä¢ Sistema multipuesto con Firebase</p>
                    <p class="firebase-status" id="firebaseStatus">Conectando...</p>
                </div>
            </div>
            
            <!-- Selector de sucursal para usuarios con m√∫ltiples sucursales -->
            <div id="sucursalSelector" class="login-card" style="display: none; margin-top: 20px;">
                <h3>Seleccionar Sucursal</h3>
                <div class="form-group">
                    <select id="selectSucursalLogin" class="form-control">
                        <option value="">Cargando sucursales...</option>
                    </select>
                </div>
                <button id="btnSelectSucursal" class="btn btn-success btn-block" onclick="seleccionarSucursal()">
                    <i class="fas fa-store"></i> Ingresar a esta sucursal
                </button>
            </div>
        </div>
        
        <!-- Informaci√≥n del sistema -->
        <div class="system-info">
            <div class="info-card">
                <h3><i class="fas fa-check-circle"></i> Sistema en Producci√≥n</h3>
                <ul>
                    <li><i class="fas fa-check"></i> Login real con Firebase Auth</li>
                    <li><i class="fas fa-check"></i> Concurrencia multipuesto con transacciones</li>
                    <li><i class="fas fa-check"></i> Control de stock en tiempo real</li>
                    <li><i class="fas fa-check"></i> Multicaja y turnos</li>
                    <li><i class="fas fa-check"></i> Cuenta corriente de clientes</li>
                    <li><i class="fas fa-check"></i> Modo emergencia offline</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Sistema Principal (visible solo con sesi√≥n) -->
    <div id="mainSystem" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 id="empresaNombre">üè™ Sistema POS</h2>
                <small id="sucursalNombre">Sucursal principal</small>
                <div class="sidebar-status">
                    <span id="sidebarUserRole">Cargando...</span>
                    <span class="status-dot online" id="sidebarStatus"></span>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <!-- Men√∫ din√°mico seg√∫n rol -->
                <div id="menuContent">
                    <!-- Se carga din√°micamente seg√∫n rol -->
                </div>
                
                <!-- Secci√≥n com√∫n -->
                <div class="menu-section">
                    <h4>Sistema</h4>
                    <a href="#" class="menu-item" data-view="configuracion">
                        <i class="fas fa-cog"></i> Configuraci√≥n
                    </a>
                    <a href="#" class="menu-item" onclick="exportarBackup()">
                        <i class="fas fa-download"></i> Exportar Backup
                    </a>
                    <a href="#" class="menu-item" onclick="importarBackup()">
                        <i class="fas fa-upload"></i> Importar Backup
                    </a>
                    <a href="#" class="menu-item logout-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                    </a>
                </div>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="main-content">
            <!-- Barra superior -->
            <div class="top-nav">
                <div class="nav-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <div class="system-indicators">
                        <div class="indicator" id="turnoIndicator">
                            <i class="fas fa-user-clock"></i>
                            <span id="turnoText">Sin turno</span>
                        </div>
                        <div class="indicator" id="cajaIndicator">
                            <i class="fas fa-cash-register"></i>
                            <span id="cajaText">Caja 1</span>
                        </div>
                        <div class="indicator" id="onlineIndicator">
                            <i class="fas fa-wifi"></i>
                            <span>Online</span>
                        </div>
                    </div>
                </div>
                
                <div class="nav-right">
                    <div class="user-profile">
                        <div class="user-info">
                            <strong id="userName">Usuario</strong>
                            <small id="userRole">Rol</small>
                        </div>
                        <div class="user-avatar" id="userAvatar">U</div>
                    </div>
                </div>
            </div>

            <!-- Contenedor de Vistas -->
            <div id="viewContainer">
                <!-- Todas las vistas se cargan din√°micamente -->
                <div id="loadingView" class="view active">
                    <div class="loading-content">
                        <div class="loader"></div>
                        <p>Inicializando sistema...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal base -->
    <div id="modalBase" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modal</h3>
                <button class="modal-close" onclick="cerrarModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>

    <!-- Scanner de c√≥digo de barras -->
    <div id="barcodeScanner" class="barcode-scanner">
        <div class="scanner-header">
            <h3>Escanear c√≥digo de barras</h3>
            <button class="btn btn-danger" onclick="cerrarScanner()">
                <i class="fas fa-times"></i> Cerrar
            </button>
        </div>
        <div class="scanner-body">
            <div id="scannerVideoContainer">
                <!-- Video del scanner -->
            </div>
            <div class="scanner-fallback">
                <p>O ingresa el c√≥digo manualmente:</p>
                <input type="text" id="manualBarcode" placeholder="C√≥digo de barras" 
                       class="form-control" style="margin-bottom: 10px;">
                <button class="btn btn-primary" onclick="procesarCodigoManual()">
                    <i class="fas fa-check"></i> Buscar
                </button>
            </div>
        </div>
    </div>

    <!-- Ticket oculto para impresi√≥n -->
    <div id="ticketContainer" style="display: none;"></div>

    <!-- Input oculto para importaciones -->
    <input type="file" id="fileImport" style="display: none;">

    <!-- Script principal -->
    <script src="app.js"></script>

<!-- Modal para clientes -->
<div id="clienteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-user-plus"></i> Nuevo Cliente</h3>
            <button class="modal-close" onclick="cerrarClienteModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="formCliente" onsubmit="guardarCliente(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="clienteNombre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Documento</label>
                        <input type="text" id="clienteDocumento" class="form-control">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" id="clienteTelefono" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="clienteEmail" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Direcci√≥n</label>
                    <input type="text" id="clienteDireccion" class="form-control">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Cliente</label>
                        <select id="clienteTipo" class="form-control">
                            <option value="consumidor">Consumidor Final</option>
                            <option value="responsable">Responsable Inscripto</option>
                            <option value="monotributo">Monotributista</option>
                            <option value="exento">Exento</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>L√≠mite de Cr√©dito</label>
                        <input type="number" id="clienteLimite" class="form-control" value="0" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="flex gap-2 mt-4">
                    <button type="button" class="btn btn-outline" onclick="cerrarClienteModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para productos r√°pidos -->
<div id="productosModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3><i class="fas fa-boxes"></i> Productos</h3>
            <button class="modal-close" onclick="cerrarProductosModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="search-box" style="margin-bottom: 20px;">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="buscarProductoModal" class="search-input" 
                       placeholder="Buscar producto por c√≥digo o nombre...">
            </div>
            <div class="quick-products" id="quickProductsGrid">
                <!-- Productos cargados din√°micamente -->
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmaci√≥n r√°pida -->
<div id="confirmModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-body text-center">
            <div class="mb-4">
                <i class="fas fa-question-circle" style="font-size: 3rem; color: var(--warning);"></i>
            </div>
            <h4 id="confirmTitle">¬øConfirmar acci√≥n?</h4>
            <p id="confirmMessage">Esta acci√≥n no se puede deshacer.</p>
            <div class="flex gap-2 mt-4">
                <button class="btn btn-outline" style="flex: 1;" onclick="cerrarConfirmModal()">Cancelar</button>
                <button class="btn btn-primary" style="flex: 1;" id="confirmActionBtn">Confirmar</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
